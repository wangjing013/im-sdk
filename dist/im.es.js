import t from"@yxim/nim-web-sdk";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},e(t,n)};var n=function(){return n=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},n.apply(this,arguments)};function o(t,e,n,o){return new(n||(n=Promise))((function(r,i){function c(t){try{a(o.next(t))}catch(t){i(t)}}function s(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}a((o=o.apply(t,e||[])).next())}))}function r(t,e){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=c.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function i(t,e,n){if(n||2===arguments.length)for(var o,r=0,i=e.length;r<i;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var c,s,a,u,f,l,p,m=(c=function(t){var e=Object.prototype.hasOwnProperty,n="~";function o(){}function r(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(t,e,o,i,c){if("function"!=typeof o)throw new TypeError("The listener must be a function");var s=new r(o,i||t,c),a=n?n+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],s]:t._events[a].push(s):(t._events[a]=s,t._eventsCount++),t}function c(t,e){0==--t._eventsCount?t._events=new o:delete t._events[e]}function s(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(n=!1)),s.prototype.eventNames=function(){var t,o,r=[];if(0===this._eventsCount)return r;for(o in t=this._events)e.call(t,o)&&r.push(n?o.slice(1):o);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},s.prototype.listeners=function(t){var e=n?n+t:t,o=this._events[e];if(!o)return[];if(o.fn)return[o.fn];for(var r=0,i=o.length,c=new Array(i);r<i;r++)c[r]=o[r].fn;return c},s.prototype.listenerCount=function(t){var e=n?n+t:t,o=this._events[e];return o?o.fn?1:o.length:0},s.prototype.emit=function(t,e,o,r,i,c){var s=n?n+t:t;if(!this._events[s])return!1;var a,u,f=this._events[s],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,o),!0;case 4:return f.fn.call(f.context,e,o,r),!0;case 5:return f.fn.call(f.context,e,o,r,i),!0;case 6:return f.fn.call(f.context,e,o,r,i,c),!0}for(u=1,a=new Array(l-1);u<l;u++)a[u-1]=arguments[u];f.fn.apply(f.context,a)}else{var p,m=f.length;for(u=0;u<m;u++)switch(f[u].once&&this.removeListener(t,f[u].fn,void 0,!0),l){case 1:f[u].fn.call(f[u].context);break;case 2:f[u].fn.call(f[u].context,e);break;case 3:f[u].fn.call(f[u].context,e,o);break;case 4:f[u].fn.call(f[u].context,e,o,r);break;default:if(!a)for(p=1,a=new Array(l-1);p<l;p++)a[p-1]=arguments[p];f[u].fn.apply(f[u].context,a)}}return!0},s.prototype.on=function(t,e,n){return i(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return i(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,o,r){var i=n?n+t:t;if(!this._events[i])return this;if(!e)return c(this,i),this;var s=this._events[i];if(s.fn)s.fn!==e||r&&!s.once||o&&s.context!==o||c(this,i);else{for(var a=0,u=[],f=s.length;a<f;a++)(s[a].fn!==e||r&&!s[a].once||o&&s[a].context!==o)&&u.push(s[a]);u.length?this._events[i]=1===u.length?u[0]:u:c(this,i)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&c(this,e)):(this._events=new o,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,t.exports=s},c(s={exports:{}},s.exports),s.exports),h=function(t){console.info("[nim]:",t)},v=function(t){console.error("[nim]:",t)};!function(t){t.owner="owner",t.manager="manager",t.restricted="restricted",t.common="common",t.guest="guest"}(a||(a={})),function(t){t.in="in",t.out="out"}(u||(u={})),function(t){t.Android="Android",t.iOS="iOS",t.PC="PC",t.Web="Web",t.Mac="Mac"}(f||(f={})),function(t){t.text="text",t.image="image",t.audio="audio",t.video="video",t.file="file",t.geo="geo",t.custom="custom",t.tip="tip",t.notification="notification"}(l||(l={})),function(t){t.memberEnter="memberEnter",t.memberExit="memberExit",t.addManager="addManager",t.removeManager="removeManager",t.addCommon="addCommon",t.removeCommon="removeCommon",t.blackMember="blackMember",t.unblackMember="unblackMember",t.gagMember="gagMember",t.ungagMember="ungagMember",t.kickMember="kickMember",t.updateChatroom="updateChatroom",t.updateMemberInfo="updateMemberInfo",t.addTempMute="addTempMute",t.removeTempMute="removeTempMute",t.muteRoom="muteRoom",t.unmuteRoom="unmuteRoom"}(p||(p={}));var y={Chatroom:function(c){function s(e){var o=c.call(this)||this;return o.chatroom=t.Chatroom.getInstance(n(n({ondisconnect:function(t){if(t)switch(t.code){case 302:v(t.message);break;case"kicked":v("已被踢")}}},e),{onmsgs:function(t){t.forEach((function(t){var e=t.type;if(e===l.text||e===l.image||e===l.audio||e===l.video||e===l.file||e===l.geo||e===l.tip)console.log("======");else if(e===l.notification){var n=t.attach;o.emit(n.type,t)}else e===l.custom||h("未知消息")}))}})),o}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}(s,c),s.getInstance=function(t){return void 0===s.instance&&(s.instance=new s(n({},t))),s.instance},s.prototype.setOptions=function(t){this.chatroom.setOptions(t)},s.prototype.getChatroom=function(){var t=this;return new Promise((function(e,n){t.chatroom.getChatroom({done:function(t,o){t?n(t):e(o)}})}))},s.prototype.getChatroomMembers=function(t){void 0===t&&(t={guest:!1,limit:100,done:function(){}}),this.chatroom.getChatroomMembers(t)},s.prototype.sendText=function(t){this.chatroom.sendText({text:t,done:function(t,e){console.log(e)}})},s.prototype.getHistoryMsgs=function(t){var e=this,n=void 0===t?{timetag:Date.now(),limit:10,msgTypes:[]}:t,o=n.timetag,r=n.limit,i=n.msgTypes;return new Promise((function(t){e.chatroom.getHistoryMsgs({timetag:o,limit:r,msgTypes:i,done:function(e,n){t([e,n])}})}))},s.prototype.getAllHistoryMsgs=function(t){var e=void 0===t?{timetag:Date.now(),limit:10,msgTypes:[]}:t,n=e.timetag,c=e.limit,s=e.msgTypes;return o(this,void 0,void 0,(function(){var t,e,o,a,u,f;return r(this,(function(r){switch(r.label){case 0:return t=[],[4,this.getHistoryMsgs({timetag:n,limit:c,msgTypes:s})];case 1:return e=r.sent(),o=e[0],a=e[1],null!==o?[3,4]:(u=a.msgs).length>=c?[4,this.getAllHistoryMsgs({timetag:u[u.length-1].time,limit:c,msgTypes:[]})]:[3,3];case 2:return f=r.sent(),t=i(i([],u,!0),f,!0),[3,4];case 3:t=i([],u,!0),r.label=4;case 4:return[2,t]}}))}))},s.prototype.connect=function(){this.chatroom.connect()},s.prototype.disconnect=function(){this.chatroom.disconnect()},s.prototype.destroy=function(){var t=this;return new Promise((function(e,n){t.chatroom.destroy({done:function(t){e(t?[t]:[null])}})}))},s.EVENTS=p,s}(m)};export default y;
