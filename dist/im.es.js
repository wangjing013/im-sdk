import t from"@yxim/nim-web-sdk";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},e(t,n)};var n=function(){return n=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},n.apply(this,arguments)};function o(t,e,n,o){return new(n||(n=Promise))((function(r,i){function s(t){try{a(o.next(t))}catch(t){i(t)}}function c(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}a((o=o.apply(t,e||[])).next())}))}function r(t,e){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}function i(t,e,n){if(n||2===arguments.length)for(var o,r=0,i=e.length;r<i;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var s,c,a,u,f,l,m,p=(s=function(t){var e=Object.prototype.hasOwnProperty,n="~";function o(){}function r(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(t,e,o,i,s){if("function"!=typeof o)throw new TypeError("The listener must be a function");var c=new r(o,i||t,s),a=n?n+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],c]:t._events[a].push(c):(t._events[a]=c,t._eventsCount++),t}function s(t,e){0==--t._eventsCount?t._events=new o:delete t._events[e]}function c(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(n=!1)),c.prototype.eventNames=function(){var t,o,r=[];if(0===this._eventsCount)return r;for(o in t=this._events)e.call(t,o)&&r.push(n?o.slice(1):o);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},c.prototype.listeners=function(t){var e=n?n+t:t,o=this._events[e];if(!o)return[];if(o.fn)return[o.fn];for(var r=0,i=o.length,s=new Array(i);r<i;r++)s[r]=o[r].fn;return s},c.prototype.listenerCount=function(t){var e=n?n+t:t,o=this._events[e];return o?o.fn?1:o.length:0},c.prototype.emit=function(t,e,o,r,i,s){var c=n?n+t:t;if(!this._events[c])return!1;var a,u,f=this._events[c],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,o),!0;case 4:return f.fn.call(f.context,e,o,r),!0;case 5:return f.fn.call(f.context,e,o,r,i),!0;case 6:return f.fn.call(f.context,e,o,r,i,s),!0}for(u=1,a=new Array(l-1);u<l;u++)a[u-1]=arguments[u];f.fn.apply(f.context,a)}else{var m,p=f.length;for(u=0;u<p;u++)switch(f[u].once&&this.removeListener(t,f[u].fn,void 0,!0),l){case 1:f[u].fn.call(f[u].context);break;case 2:f[u].fn.call(f[u].context,e);break;case 3:f[u].fn.call(f[u].context,e,o);break;case 4:f[u].fn.call(f[u].context,e,o,r);break;default:if(!a)for(m=1,a=new Array(l-1);m<l;m++)a[m-1]=arguments[m];f[u].fn.apply(f[u].context,a)}}return!0},c.prototype.on=function(t,e,n){return i(this,t,e,n,!1)},c.prototype.once=function(t,e,n){return i(this,t,e,n,!0)},c.prototype.removeListener=function(t,e,o,r){var i=n?n+t:t;if(!this._events[i])return this;if(!e)return s(this,i),this;var c=this._events[i];if(c.fn)c.fn!==e||r&&!c.once||o&&c.context!==o||s(this,i);else{for(var a=0,u=[],f=c.length;a<f;a++)(c[a].fn!==e||r&&!c[a].once||o&&c[a].context!==o)&&u.push(c[a]);u.length?this._events[i]=1===u.length?u[0]:u:s(this,i)}return this},c.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&s(this,e)):(this._events=new o,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=n,c.EventEmitter=c,t.exports=c},s(c={exports:{}},c.exports),c.exports),h=function(t){console.info("[nim]:",t)},v=function(t){console.error("[nim]:",t)};!function(t){t.owner="owner",t.manager="manager",t.restricted="restricted",t.common="common",t.guest="guest"}(a||(a={})),function(t){t.in="in",t.out="out"}(u||(u={})),function(t){t.Android="Android",t.iOS="iOS",t.PC="PC",t.Web="Web",t.Mac="Mac"}(f||(f={})),function(t){t.text="text",t.image="image",t.audio="audio",t.video="video",t.file="file",t.geo="geo",t.custom="custom",t.tip="tip",t.notification="notification"}(l||(l={})),function(t){t.memberEnter="memberEnter",t.memberExit="memberExit",t.addManager="addManager",t.removeManager="removeManager",t.addCommon="addCommon",t.removeCommon="removeCommon",t.blackMember="blackMember",t.unblackMember="unblackMember",t.gagMember="gagMember",t.ungagMember="ungagMember",t.kickMember="kickMember",t.updateChatroom="updateChatroom",t.updateMemberInfo="updateMemberInfo",t.addTempMute="addTempMute",t.removeTempMute="removeTempMute",t.muteRoom="muteRoom",t.unmuteRoom="unmuteRoom"}(m||(m={}));var y={Chatroom:function(s){function c(e){var o=s.call(this)||this;return o.chatroom=t.Chatroom.getInstance(n(n({},e),{ondisconnect:function(t){if(t)switch(t.code){case 302:case"kicked":v(t.message)}},onmsgs:function(t){t.forEach((function(t){var e=t.type;if(e===l.text||e===l.image||e===l.audio||e===l.video||e===l.file||e===l.geo||e===l.tip);else if(e===l.notification){var n=t.attach;o.emit(n.type,t)}else e===l.custom||h("未知消息")}))}})),o}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}(c,s),c.getInstance=function(t){return c.instance||(c.instance=new c(n({},t))),c.instance},c.prototype.setOptions=function(t){this.chatroom.setOptions(t)},c.prototype.getChatroom=function(){var t=this;return new Promise((function(e){t.chatroom.getChatroom({done:function(t,n){e([t,n])}})}))},c.prototype.updateChatroom=function(t){var e=this;return new Promise((function(n){e.chatroom.updateChatroom({chatroom:t.chatroom,needNotify:t.needNotify,done:function(t,e){n([t,e])}})}))},c.prototype.getAllChatroomMembers=function(t){var e=void 0===t?{}:t,n=e.guest,s=void 0!==n&&n,c=e.limit,a=void 0===c?100:c,u=e.time,f=void 0===u?0:u;return o(this,void 0,void 0,(function(){var t,e,n,o,c,u;return r(this,(function(r){switch(r.label){case 0:return t=[],[4,this.getChatroomMembers({guest:s,limit:a,time:f})];case 1:return e=r.sent(),n=e[0],o=e[1],null!==n?[3,4]:(c=o.members).length>=o.limit?[4,this.getAllChatroomMembers({guest:s,limit:o.limit,time:c[c.length-1].updateTime})]:[3,3];case 2:return u=r.sent(),t=i(i([],c,!0),u,!0),[3,4];case 3:t=i([],c,!0),r.label=4;case 4:return[2,t]}}))}))},c.prototype.getChatroomMembers=function(t){var e=this,n=void 0===t?{}:t,o=n.guest,r=void 0!==o&&o,i=n.limit,s=void 0===i?100:i,c=n.time,a=void 0===c?0:c;return new Promise((function(t){e.chatroom.getChatroomMembers({guest:r,limit:s,time:a,done:function(e,n){t([e,n])}})}))},c.prototype.getHistoryMsgs=function(t){var e=this,n=void 0===t?{}:t,o=n.timetag,r=void 0===o?Date.now():o,i=n.limit,s=void 0===i?100:i,c=n.msgTypes,a=void 0===c?[]:c;return new Promise((function(t){e.chatroom.getHistoryMsgs({timetag:r,limit:s,msgTypes:a,done:function(e,n){t([e,n])}})}))},c.prototype.getAllHistoryMsgs=function(t){var e=void 0===t?{}:t,n=e.timetag,s=e.limit,c=e.msgTypes;return o(this,void 0,void 0,(function(){var t,e,o,a,u,f;return r(this,(function(r){switch(r.label){case 0:return t=[],[4,this.getHistoryMsgs({timetag:n,limit:s,msgTypes:c})];case 1:return e=r.sent(),o=e[0],a=e[1],null!==o?[3,4]:(u=a.msgs).length>=a.limit?[4,this.getAllHistoryMsgs({limit:s,msgTypes:c,timetag:u[u.length-1].time})]:[3,3];case 2:return f=r.sent(),t=i(i([],u,!0),f,!0),[3,4];case 3:t=i([],u,!0),r.label=4;case 4:return[2,t]}}))}))},c.prototype.sendText=function(t){var e=this;return new Promise((function(n){e.chatroom.sendText({text:t,done:function(t,e){n([t,e])}})}))},c.prototype.connect=function(){this.chatroom.connect()},c.prototype.disconnect=function(){this.chatroom.disconnect()},c.prototype.destroy=function(){var t=this;return new Promise((function(e,n){t.chatroom.destroy({done:function(t){e([t])}})}))},c.EVENTS=m,c}(p)};export default y;
